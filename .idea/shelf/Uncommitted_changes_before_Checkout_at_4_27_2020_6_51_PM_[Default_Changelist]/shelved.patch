Index: src/controllers/commands/markers/MarkerCreateCommand.ts
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import Sequelize from \"sequelize\";\r\nimport * as Helper from \"../helpers/helper\";\r\nimport { ErrorCodeLookup } from \"../../lookups/stringLookup\";\r\nimport * as DatabaseConnection from \"../models/databaseConnection\";\r\nimport * as MarkersRepository from \"../models/entities/MarkersModel\";\r\nimport { CommandResponse, Markers, MarkersSaveRequest } from \"../../typeDefinitions\";\r\nimport { MarkersModel } from \"../models/entities/MarkersModel\";\r\n\r\n\r\nconst validateSaveRequest = (saveMarkersRequest: MarkersSaveRequest): CommandResponse<Markers> => {\r\n\tconst validationResponse: CommandResponse<Markers> =\r\n\t\t<CommandResponse<Markers>>{ status: 200 };\r\n\r\n\tif ((saveMarkersRequest.location == null) || (saveMarkersRequest.location.trim() === \"\")) {\r\n\t\tvalidationResponse.status = 422;\r\n\t\tvalidationResponse.message = ErrorCodeLookup.EC2026;\r\n\t} else if ((saveMarkersRequest.MarkerID == null) || isNaN(saveMarkersRequest.MarkerID)) {\r\n\t\tvalidationResponse.status = 422;\r\n\t\tvalidationResponse.message = ErrorCodeLookup.EC2027;\r\n\t} else if (saveMarkersRequest.MarkerID < 0) {\r\n\t\tvalidationResponse.status = 422;\r\n\t\tvalidationResponse.message = ErrorCodeLookup.EC2028;\r\n\t} else if (saveMarkersRequest.id == null) {\r\n        validationResponse.status = 422;\r\n        validationResponse.message = ErrorCodeLookup.EC2028B;\r\n    }\r\n\r\n\treturn validationResponse;\r\n};\r\n\r\nexport const execute = async (saveMarkersRequest: MarkersSaveRequest): Promise<CommandResponse<Markers>> => {\r\n\tconst validationResponse: CommandResponse<Markers> = validateSaveRequest(saveMarkersRequest);\r\n\tif (validationResponse.status !== 200) {\r\n\t\treturn Promise.reject(validationResponse);\r\n\t}\r\n\r\n\tconst request = require(\"request\");\r\n\tconst openWeatherKey = \"80f0f7a1ea95a376129420c77fe45bb9\";\r\n\tconst url = `http://api.openweathermap.org/data/2.5/weather?lat=${saveMarkersRequest.Latitude}&lon=${saveMarkersRequest.Longitude}&units=imperial&appid=${openWeatherKey}`;\r\n    let json = \"\"; //not a const anymore\r\n\r\n\trequest(url, function (err, response, body) {\r\n\t\tif(err) {\r\n\t\t\tconsole.log(\"error:\", err);\r\n\t\t} else {\r\n\t\t\tjson = body;\r\n\t\t\tconsole.log(\"body:\", body);\r\n\t\t}\r\n\t});\r\n\r\n\r\n\tconst weather = JSON.parse(json);\r\n\t// sends current data not arrival time data\r\n\t// sends cloud cover instead of precipitation chance because I cant find it in the messages anymore\r\n\tconst markerToCreate: MarkersModel = <MarkersModel>{\r\n\t\tid:saveMarkersRequest.id,\r\n\t\tTemperature: weather.main.temp,\r\n\t\tMarkerID: saveMarkersRequest.MarkerID,\r\n\t\tprecipChance: weather.clouds.all,\r\n\t\tLatitude: saveMarkersRequest.Latitude,\r\n\t\tLongitude: saveMarkersRequest.Longitude,\r\n\t\tlocation: saveMarkersRequest.location,\r\n\t\tArrivalTime: saveMarkersRequest.ArrivalTime\r\n\r\n\t};\r\n\r\n\tlet createTransaction: Sequelize.Transaction;\r\n\r\n\treturn DatabaseConnection.startTransaction() \r\n\t\t.then((createdTransaction: Sequelize.Transaction): Promise<MarkersModel | null> => {\r\n\t\t\tcreateTransaction = createdTransaction;\r\n\r\n\t\t\treturn MarkersRepository.queryByMarkerID(\r\n\t\t\t\tsaveMarkersRequest.MarkerID,\r\n\t\t\t\tcreateTransaction);\r\n\t\t}).then((existingMarker: (MarkersModel | null)): Promise<MarkersModel> => {\r\n\t\t\tif (existingMarker != null) {\r\n\t\t\t\treturn Promise.reject(<CommandResponse<Markers>>{\r\n\t\t\t\t\tstatus: 409,\r\n\t\t\t\t\tmessage: ErrorCodeLookup.EC2029\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn MarkersModel.create(\r\n\t\t\t\tmarkerToCreate,\r\n\t\t\t\t<Sequelize.CreateOptions>{\r\n\t\t\t\t\ttransaction: createTransaction\r\n\t\t\t\t});\r\n\t\t}).then((createdMarker: MarkersModel): Promise<CommandResponse<Markers>> => {\r\n\t\t\tcreateTransaction.commit();\r\n\r\n\t\t\treturn Promise.resolve(<CommandResponse<Markers>>{\r\n\t\t\t\tstatus: 201,\r\n\t\t\t\tdata: <Markers>{\r\n\t\t\t\t\tid: createdMarker.id,\r\n\t\t\t\t\tMarkerID: createdMarker.MarkerID,\r\n\t\t\t\t\tlocation: createdMarker.location,\r\n\t\t\t\t\tArrivalTime: Helper.formatDate(createdMarker.ArrivalTime),\r\n\t\t\t\t\tLongitude: createdMarker.Longitude,\r\n\t\t\t\t\tLatitude: createdMarker.Latitude,\r\n\t\t\t\t\tTemperature: createdMarker.Temperature,\r\n\t\t\t\t\tprecipChance: createdMarker.precipChance\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}).catch((error: any): Promise<CommandResponse<Markers>> => {\r\n\t\t\tif (createTransaction != null) {\r\n\t\t\t\tcreateTransaction.rollback();\r\n\t\t\t}\r\n\r\n\t\t\treturn Promise.reject(<CommandResponse<Markers>>{\r\n\t\t\t\tstatus: (error.status || 500),\r\n\t\t\t\tmessage: (error.message || ErrorCodeLookup.EC1002)\r\n\t\t\t});\r\n\t\t});\r\n};\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- src/controllers/commands/markers/MarkerCreateCommand.ts	(revision 62f0db0f10882d10748a35afbbff9776625ff85a)
+++ src/controllers/commands/markers/MarkerCreateCommand.ts	(date 1588031459504)
@@ -37,7 +37,7 @@
 	const request = require("request");
 	const openWeatherKey = "80f0f7a1ea95a376129420c77fe45bb9";
 	const url = `http://api.openweathermap.org/data/2.5/weather?lat=${saveMarkersRequest.Latitude}&lon=${saveMarkersRequest.Longitude}&units=imperial&appid=${openWeatherKey}`;
-    let json = ""; //not a const anymore
+    let json = "";
 
 	request(url, function (err, response, body) {
 		if(err) {
